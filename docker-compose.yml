services:
  skippr:
    build: .
    container_name: skippr
    restart: unless-stopped

    ports:
      - "7681:7681"

    volumes:
      # Persistent home directory - keeps all user data across redeployments
      # Config files (.zshrc, .tmux.conf, etc.) are refreshed from repo on each deploy
      - skippr-home:/home/dev

    # Security hardening
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE

    environment:
      # Optional: Set timezone
      - TZ=${TZ:-UTC}

      # Git configuration (set in Coolify env vars)
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}

    # Coolify-compatible labels
    labels:
      - "coolify.managed=true"
      # Security: Access Skippr via Tailscale IP only (no public domain needed)

volumes:
  skippr-home:
    driver: local
